"use strict";var d=Object.defineProperty;var c=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var p=(n,t)=>{for(var e in t)d(n,e,{get:t[e],enumerable:!0})},f=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of m(t))!h.call(n,r)&&r!==e&&d(n,r,{get:()=>t[r],enumerable:!(i=c(t,r))||i.enumerable});return n};var P=n=>f(d({},"__esModule",{value:!0}),n);var b={};p(b,{Offer:()=>l,OfferItem:()=>a});module.exports=P(b);var o={BOTTLE:1,CASE_3:3,CASE_4:4,CASE_6:6,CASE_12:12,CASE_24:24};var s=n=>Math.round((n+Number.EPSILON)*100)/100;var a=class n{id;price;discount;margin;unit;quantity;vatRate;tags;availableUnits;glassPrice;data;pricePerBottle;pricePerUnit;gross;vatAmount;customerPrice;totalPrice;constructor(t){this.id=t.id||crypto.randomUUID(),this.price=t.price,this.unit=t.unit||"bottle",this.quantity=t.quantity??1,this.vatRate=t.vatRate??25.5,this.tags=t.tags||[],this.availableUnits=t.availableUnits||["bottle"],this.glassPrice=t.glassPrice,this.data=t.data||{},t.discount!==void 0&&t.pricePerBottle!==void 0?(this.discount=t.discount,this.pricePerBottle=t.pricePerBottle):t.pricePerBottle!==void 0?(this.pricePerBottle=t.pricePerBottle,this.discount=s((1-this.pricePerBottle/this.price)*100)):(this.discount=s(t.discount||0),this.pricePerBottle=s(this.price*(1-this.discount/100)));let e=o[this.unit.toUpperCase()]||1;if(this.pricePerUnit=s(this.pricePerBottle*e),t.customerPrice!==void 0)if(this.customerPrice=t.customerPrice,t.gross!==void 0){this.gross=t.gross;let i=this.pricePerBottle+this.gross;this.vatAmount=s(this.customerPrice-i),this.margin=t.margin!==void 0?t.margin:s(this.gross/i*100)}else{let i=this.customerPrice/(1+this.vatRate/100);this.vatAmount=s(this.customerPrice-i),this.gross=s(i-this.pricePerBottle),this.margin=t.margin!==void 0?t.margin:s(this.gross/i*100)}else if(t.gross!==void 0){this.gross=t.gross;let i=this.pricePerBottle+this.gross;this.vatAmount=s(i*(this.vatRate/100)),this.customerPrice=s(i+this.vatAmount),this.margin=t.margin!==void 0?t.margin:s(this.gross/i*100)}else{this.margin=s(t.margin||0);let i=1-this.margin/100;this.gross=i===0?0:s(this.pricePerBottle/i-this.pricePerBottle);let r=this.pricePerBottle+this.gross;this.vatAmount=s(r*(this.vatRate/100)),this.customerPrice=s(r+this.vatAmount)}this.totalPrice=s(this.pricePerUnit*this.quantity),Object.freeze(this)}update(t){let e=this.toConfig();return t.price!==void 0&&(delete e.pricePerBottle,delete e.gross,delete e.customerPrice),t.discount!==void 0&&delete e.pricePerBottle,t.pricePerBottle!==void 0&&delete e.discount,t.margin!==void 0&&(delete e.gross,delete e.customerPrice),t.gross!==void 0&&(delete e.margin,delete e.customerPrice),t.customerPrice!==void 0&&(delete e.margin,delete e.gross),new n({...e,...t})}roundCustomerPrice(t=1){let e=Math.round(this.customerPrice/t)*t;return this.update({customerPrice:s(e)})}roundGlassPrice(t=1){if(this.glassPrice===void 0)return this;let e=Math.round(this.glassPrice/t)*t;return this.update({glassPrice:s(e)})}toConfig(){return{id:this.id,price:this.price,discount:this.discount,margin:this.margin,unit:this.unit,quantity:this.quantity,vatRate:this.vatRate,tags:[...this.tags],availableUnits:[...this.availableUnits],glassPrice:this.glassPrice,gross:this.gross,customerPrice:this.customerPrice,pricePerBottle:this.pricePerBottle,data:{...this.data}}}toJSON(){return{...this.toConfig(),pricePerUnit:this.pricePerUnit,vatAmount:this.vatAmount,totalPrice:this.totalPrice}}};var l=class n{id;title;items;menu;data;totals;constructor(t={}){this.id=t.id||crypto.randomUUID(),this.title=t.title||"",this.items=Object.freeze(t.items||[]),this.menu=t.menu||null,this.data=t.data||{},this.totals=Object.freeze(this._calculateGrandTotals()),Object.freeze(this)}_calculateGrandTotals(){return this.items.reduce((t,e)=>{let i=this._getMultiplier(e),r=e.quantity*i,u=s((e.price-e.pricePerBottle)*r);return{totalPrice:s(t.totalPrice+e.totalPrice),totalSaved:s(t.totalSaved+u)}},{totalPrice:0,totalSaved:0})}_getMultiplier(t){return o[t.unit]||1}updateTitle(t){return new n({...this,title:t})}setMenu(t){return new n({...this,menu:t})}addItems(t){let e=t.map(i=>new a(i));return new n({...this,items:[...this.items,...e]})}removeItems(t){return new n({...this,items:this.items.filter(e=>!t.includes(e.id))})}updateItem(t,e){let i=this.items.map(r=>r.id!==t?r:typeof e=="function"?e(r):r.update(e));return new n({...this,items:i})}swapItem(t,e){let i=this.items.map(r=>r.id===t?new a(e):r);return new n({...this,items:i})}bulkUpdateField(t,e,i){let r=this.items.map(u=>t&&!t.includes(u.id)?u:u.update({[e]:i}));return new n({...this,items:r})}setMargin(t,e){return this.bulkUpdateField(e,"margin",t)}setGross(t,e){return this.bulkUpdateField(e,"gross",t)}setDiscount(t,e){return this.bulkUpdateField(e,"discount",t)}setQuantity(t,e){return this.bulkUpdateField(e,"quantity",t)}setVatRate(t,e){return this.bulkUpdateField(e,"vatRate",t)}setGlassPrice(t,e){return this.bulkUpdateField(e,"glassPrice",t)}roundCustomerPrices(t=1,e){let i=this.items.map(r=>e&&!e.includes(r.id)?r:r.roundCustomerPrice(t));return new n({...this,items:i})}roundGlassPrices(t=1,e){let i=this.items.map(r=>e&&!e.includes(r.id)?r:r.roundGlassPrice(t));return new n({...this,items:i})}setUnit(t,e){if(!o[t.toUpperCase()])return this;let i=this.items.map(r=>e&&!e.includes(r.id)||!r.availableUnits.includes(t)?r:r.update({unit:t}));return new n({...this,items:i})}toJSON(){return{id:this.id,title:this.title,menu:this.menu,items:this.items.map(t=>t.toJSON()),totals:this.totals,data:this.data}}};0&&(module.exports={Offer,OfferItem});
