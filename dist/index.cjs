"use strict";var c=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var I=(r,t)=>{for(var e in t)c(r,e,{get:t[e],enumerable:!0})},P=(r,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of b(t))!y.call(r,i)&&i!==e&&c(r,i,{get:()=>t[i],enumerable:!(s=g(t,i))||s.enumerable});return r};var O=r=>P(c({},"__esModule",{value:!0}),r);var C={};I(C,{Offer:()=>l,OfferItem:()=>a});module.exports=O(C);var u={BOTTLE:1,CASE_3:3,CASE_4:4,CASE_6:6,CASE_12:12,CASE_24:24};var n=r=>Math.round((r+Number.EPSILON)*100)/100;var a=class r{id;price;discount;margin;unit;quantity;vatRate;tags;data;_isExplicitGross;pricePerBottle;pricePerUnit;gross;vatAmount;customerPrice;totalPrice;constructor(t){this.id=t.id||crypto.randomUUID(),this.price=t.price,this.discount=n(t.discount||0),this.margin=n(t.margin||0),this.unit=t.unit||"bottle",this.quantity=t.quantity??1,this.vatRate=t.vatRate??25.5,this.tags=t.tags||[],this.data=t.data||{},this._isExplicitGross=t.gross!==void 0;let e=this._calculate(t.gross);this.pricePerBottle=e.pricePerBottle,this.pricePerUnit=e.pricePerUnit,this.gross=e.gross,this.vatAmount=e.vatAmount,this.customerPrice=e.customerPrice,this.totalPrice=e.totalPrice,Object.freeze(this)}_calculate(t){let e=n(this.price*(1-this.discount/100)),s=u[this.unit.toUpperCase()]||1,i=n(e*s),o;if(t!==void 0)o=t;else{let f=1-this.margin/100;o=f===0?0:n(e/f-e)}let m=e+o,p=n(m*(this.vatRate/100)),d=n(m+p),h=d*s*this.quantity;return{pricePerBottle:e,pricePerUnit:i,gross:o,vatAmount:p,customerPrice:d,totalPrice:h}}update(t){let e=this.toConfig();return t.margin!==void 0&&t.gross===void 0&&delete e.gross,new r({...e,...t})}updateCustomerPrice(t){let e=t/(1+this.vatRate/100),s=e-this.pricePerBottle,i=n(s/e*100);return this.update({margin:i})}updatePricePerBottle(t){let e=n((1-t/this.price)*100);return this.update({discount:e})}updateGross(t){let e=this.pricePerBottle+t,s=n(t/e*100);return new r({...this.toConfig(),margin:s,gross:t})}toConfig(){let t={id:this.id,price:this.price,discount:this.discount,margin:this.margin,unit:this.unit,quantity:this.quantity,vatRate:this.vatRate,tags:[...this.tags],data:{...this.data}};return this._isExplicitGross&&(t.gross=this.gross),t}toJSON(){return{...this.toConfig(),pricePerBottle:this.pricePerBottle,pricePerUnit:this.pricePerUnit,gross:this.gross,vatAmount:this.vatAmount,customerPrice:this.customerPrice,totalPrice:this.totalPrice}}};var l=class r{id;title;items;menu;data;totals;constructor(t={}){this.id=t.id||crypto.randomUUID(),this.title=t.title||"",this.items=Object.freeze(t.items||[]),this.menu=t.menu||null,this.data=t.data||{},this.totals=Object.freeze(this._calculateGrandTotals()),Object.freeze(this)}_calculateGrandTotals(){return this.items.reduce((t,e)=>({totalNet:n(t.totalNet+e.pricePerUnit*e.quantity),totalVat:n(t.totalVat+e.vatAmount*(e.quantity*this._getMultiplier(e))),totalGross:n(t.totalGross+e.totalPrice)}),{totalNet:0,totalVat:0,totalGross:0})}_getMultiplier(t){return u[t.unit]||1}updateTitle(t){return new r({...this,title:t})}setMenu(t){return new r({...this,menu:t})}addItems(t){let e=t.map(s=>new a(s));return new r({...this,items:[...this.items,...e]})}removeItems(t){return new r({...this,items:this.items.filter(e=>!t.includes(e.id))})}updateItem(t,e){let s=this.items.map(i=>i.id!==t?i:typeof e=="function"?e(i):i.update(e));return new r({...this,items:s})}swapItem(t,e){let s=this.items.map(i=>i.id===t?new a(e):i);return new r({...this,items:s})}bulkUpdateField(t,e,s){let i=this.items.map(o=>t.includes(o.id)?o.update({[e]:s}):o);return new r({...this,items:i})}toJSON(){return{id:this.id,title:this.title,menu:this.menu,items:this.items.map(t=>t.toJSON()),totals:this.totals,data:this.data}}};0&&(module.exports={Offer,OfferItem});
