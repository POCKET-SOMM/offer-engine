"use strict";var c=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var p=(r,t)=>{for(var e in t)c(r,e,{get:t[e],enumerable:!0})},f=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of m(t))!h.call(r,s)&&s!==e&&c(r,s,{get:()=>t[s],enumerable:!(i=d(t,s))||i.enumerable});return r};var g=r=>f(c({},"__esModule",{value:!0}),r);var P={};p(P,{Offer:()=>u,OfferItem:()=>o});module.exports=g(P);var a={BOTTLE:1,CASE_3:3,CASE_4:4,CASE_6:6,CASE_12:12,CASE_24:24};var n=r=>Math.round((r+Number.EPSILON)*100)/100;var o=class r{id;price;discount;margin;unit;quantity;vatRate;tags;data;_explicitFields;pricePerBottle;pricePerUnit;gross;vatAmount;customerPrice;totalPrice;constructor(t){this.id=t.id||crypto.randomUUID(),this.price=t.price,this.unit=t.unit||"bottle",this.quantity=t.quantity??1,this.vatRate=t.vatRate??25.5,this.tags=t.tags||[],this.data=t.data||{},this._explicitFields=new Set,t.customerPrice!==void 0&&this._explicitFields.add("customerPrice"),t.gross!==void 0&&this._explicitFields.add("gross"),t.pricePerBottle!==void 0&&this._explicitFields.add("pricePerBottle"),t.pricePerBottle!==void 0?(this.pricePerBottle=t.pricePerBottle,this.discount=n((1-this.pricePerBottle/this.price)*100)):(this.discount=n(t.discount||0),this.pricePerBottle=n(this.price*(1-this.discount/100)));let e=a[this.unit.toUpperCase()]||1;if(this.pricePerUnit=n(this.pricePerBottle*e),t.customerPrice!==void 0){this.customerPrice=t.customerPrice;let i=this.customerPrice/(1+this.vatRate/100);this.vatAmount=n(this.customerPrice-i),this.gross=i-this.pricePerBottle,this.margin=n(this.gross/i*100)}else if(t.gross!==void 0){this.gross=t.gross;let i=this.pricePerBottle+this.gross;this.vatAmount=n(i*(this.vatRate/100)),this.customerPrice=n(i+this.vatAmount),this.margin=n(this.gross/i*100)}else{this.margin=n(t.margin||0);let i=1-this.margin/100;this.gross=i===0?0:n(this.pricePerBottle/i-this.pricePerBottle);let s=this.pricePerBottle+this.gross;this.vatAmount=n(s*(this.vatRate/100)),this.customerPrice=n(s+this.vatAmount)}this.totalPrice=this.customerPrice*e*this.quantity,Object.freeze(this)}update(t){let e=this.toConfig();return t.margin!==void 0&&t.gross===void 0&&t.customerPrice===void 0&&(delete e.gross,delete e.customerPrice),t.gross!==void 0&&t.customerPrice===void 0&&delete e.customerPrice,t.discount!==void 0&&t.pricePerBottle===void 0&&delete e.pricePerBottle,new r({...e,...t})}toConfig(){let t={id:this.id,price:this.price,discount:this.discount,margin:this.margin,unit:this.unit,quantity:this.quantity,vatRate:this.vatRate,tags:[...this.tags],data:{...this.data}};return this._explicitFields.has("customerPrice")&&(t.customerPrice=this.customerPrice),this._explicitFields.has("gross")&&(t.gross=this.gross),this._explicitFields.has("pricePerBottle")&&(t.pricePerBottle=this.pricePerBottle),t}toJSON(){return{...this.toConfig(),pricePerBottle:this.pricePerBottle,pricePerUnit:this.pricePerUnit,gross:this.gross,vatAmount:this.vatAmount,customerPrice:this.customerPrice,totalPrice:this.totalPrice}}};var u=class r{id;title;items;menu;data;totals;constructor(t={}){this.id=t.id||crypto.randomUUID(),this.title=t.title||"",this.items=Object.freeze(t.items||[]),this.menu=t.menu||null,this.data=t.data||{},this.totals=Object.freeze(this._calculateGrandTotals()),Object.freeze(this)}_calculateGrandTotals(){return this.items.reduce((t,e)=>({totalNet:n(t.totalNet+e.pricePerUnit*e.quantity),totalVat:n(t.totalVat+e.vatAmount*(e.quantity*this._getMultiplier(e))),totalGross:n(t.totalGross+e.totalPrice)}),{totalNet:0,totalVat:0,totalGross:0})}_getMultiplier(t){return a[t.unit]||1}updateTitle(t){return new r({...this,title:t})}setMenu(t){return new r({...this,menu:t})}addItems(t){let e=t.map(i=>new o(i));return new r({...this,items:[...this.items,...e]})}removeItems(t){return new r({...this,items:this.items.filter(e=>!t.includes(e.id))})}updateItem(t,e){let i=this.items.map(s=>s.id!==t?s:typeof e=="function"?e(s):s.update(e));return new r({...this,items:i})}swapItem(t,e){let i=this.items.map(s=>s.id===t?new o(e):s);return new r({...this,items:i})}bulkUpdateField(t,e,i){let s=this.items.map(l=>t&&!t.includes(l.id)?l:l.update({[e]:i}));return new r({...this,items:s})}setMargin(t,e){return this.bulkUpdateField(e,"margin",t)}setGross(t,e){return this.bulkUpdateField(e,"gross",t)}setDiscount(t,e){return this.bulkUpdateField(e,"discount",t)}setQuantity(t,e){return this.bulkUpdateField(e,"quantity",t)}setVatRate(t,e){return this.bulkUpdateField(e,"vatRate",t)}setUnit(t,e){return a[t.toUpperCase()]?this.bulkUpdateField(e,"unit",t):this}toJSON(){return{id:this.id,title:this.title,menu:this.menu,items:this.items.map(t=>t.toJSON()),totals:this.totals,data:this.data}}};0&&(module.exports={Offer,OfferItem});
